<%= render 'shared/navbar' %>
<%= render 'carousel' %>
<% sum = 0 %>
<% @issue.votes.each { |vote| sum += vote.direction } %>


<div class="container">
  <div class="issue-title">
    <div class="title-flex">
      <h2><%= @issue.title %></h2>
      <div class="votes">
        <%= link_to issue_votes_path(@issue, direction: 1), method: "post" do %>
          <i class="fas fa-thumbs-up" style="color: green;"></i>
        <% end %>
        <p style="font-size: 30px;"><%= sum %></p>
        <%= link_to issue_votes_path(@issue, direction: -1), method: "post" do %>
            <i class="fas fa-thumbs-down" style="color: red;"></i>
        <% end %>
      </div>
    </div>
    <div class="issue-title-username">
      <p>Posted by <%= @issue.user.username %></p>
      <%= cl_image_tag "default-avatar", class: "profile" %>
    </div>
  </div>
  <h3>Description</h3>
  <p><%= @issue.description %></p>

  <h3>Solution</h3>
  <p><%= @issue.solution %></p>
  <div class="comment-thread">
  <div id="top-comments">
    <% @comments.first(3).each do |comment| %>
      <div class="comment">
        <div class="comment-user">
          <%= cl_image_tag "default-avatar", class: "comment-avatar" %>
          <span><strong><%= comment.user.username %></strong></span>
          <p><em><%= comment.created_at %></em></p>
        </div>
        <p><%= comment.content %></p>
        <%= link_to comment_path(comment), method: "delete", class: "delete-comment" do %>
          <i class="fas fa-trash-alt"></i>
        <% end %>
      </div>
    <% end %>
  </div>
  <div id="all-comments">
    <% @comments.drop(3).each do |comment| %>
      <div class="comment">
        <div class="comment-user">
          <%= cl_image_tag "default-avatar", class: "comment-avatar" %>
          <span><strong><%= comment.user.username %></strong></span>
          <p><em><%= comment.created_at %></em></p>
        </div>
        <p><%= comment.content %></p>
        <%= link_to comment_path(comment), method: "delete", class: "delete-comment" do %>
          <i class="fas fa-trash-alt"></i>
        <% end %>
      </div>
    <% end %>
  </div>
  <p id="toggle-all-comments"><i class="fas fa-angle-down"></i> See all comments</p>
  <p id="hide-all-comments"><i class="fas fa-angle-up"></i> Hide comments</p>
</div>

<button id="openCommentFormBtn" class="button button-icon"><i class="fas fa-comments"></i>Add a comment</button>
<div id="comment-form">
  <%= simple_form_for [@issue, @comment] do |f| %>
  <%= f.input :content, label: false %>
  <button type="submit" class="button button-icon"><i class="fas fa-comment"></i>Comment</button>
  <% end %>
</div>

</div>


<style>
  .title-flex {
    display: flex;
  }

  .title-flex h2 {
    margin-top: 0;
    padding-top: 25px;
  }

  .votes {
    padding: 25px 0 12.5px 0;
    margin-left: 50px;
    display: flex;
    align-items: center;
    text-align: center;
    justify-content: space-between;
    flex: 1 0 100px;
  }

  .votes i {
    font-size: 30px;
    color: black;
  }

  .item-size {
    height: calc(50vh - 70px);
    width: 100%;
  }

  #photo-size {
    height: calc(50vh - 70px);
    width: 100%;
  }

  .issue-title-username {
    display: flex;
    align-items: center;
  }

  .issue-title-username p{
    margin-bottom: 0;
  }


</style>

<script>
  const bullets = document.querySelectorAll(".carousel-indicators-bullet")
  bullets[0].classList.add("active");

  const photos = document.querySelectorAll(".item-size");
  photos[0].classList.add("active");

</script>
